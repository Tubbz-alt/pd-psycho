#N canvas 677 76 696 355 10;
#X obj 112 101 bng 15 250 50 0 empty empty empty 17 7 0 10 -228856
-1 -1;
#X obj 112 126 t b b, f 14;
#X obj 193 213 display;
#X obj 193 267 display;
#X obj 332 101 bng 15 250 50 0 empty empty empty 17 7 0 10 -228856
-1 -1;
#X obj 332 123 trigger bang bang;
#X obj 142 185 tonalness;
#X obj 431 225 display;
#X obj 362 268 display;
#N canvas 556 30 511 354 tonalness 0;
#X obj 245 27 inlet;
#X obj 136 27 inlet;
#N canvas 544 79 376 391 YL 0;
#X obj 237 189 list store;
#X obj 124 97 until;
#X obj 124 210 list store;
#X obj 124 125 f;
#X obj 152 125 + 1;
#X msg 171 97 0, f 2;
#X msg 124 154 get \$1 1;
#X obj 124 185 t a a;
#X obj 114 295 list store, f 16;
#X msg 124 266 append \$1;
#X obj 294 38 inlet;
#X obj 67 40 inlet;
#X obj 114 331 outlet;
#X obj 67 331 outlet;
#X obj 67 70 trigger list bang bang bang list;
#N canvas 580 226 601 472 get-Lth 0;
#X obj 133 48 inlet;
#X obj 272 408 outlet;
#X obj 154 184 exp;
#X obj 75 247 expr (3.64 * pow($f1 \, -0.8));
#X obj 154 161 expr -0.6 * pow($f1 - 3.3 \, 2);
#X obj 343 160 expr (pow(10 \, -3) * pow($f1 \, 4));
#X obj 133 109 trigger float float float;
#X obj 154 206 * 6.5;
#X obj 178 299 expr $f1 - $f2 + $f3;
#X text 147 300 Lth;
#X obj 133 76 / 1000;
#X obj 272 346 expr $f2 - $f1;
#X obj 375 59 inlet;
#X text 423 112 dB;
#X obj 373 113 rmstodb;
#X text 280 378 YL;
#X connect 0 0 10 0;
#X connect 2 0 7 0;
#X connect 3 0 8 0;
#X connect 4 0 2 0;
#X connect 5 0 8 2;
#X connect 6 0 3 0;
#X connect 6 1 4 0;
#X connect 6 2 5 0;
#X connect 7 0 8 1;
#X connect 8 0 11 0;
#X connect 10 0 6 0;
#X connect 11 0 1 0;
#X connect 12 0 14 0;
#X connect 14 0 11 1;
#X restore 124 239 pd get-Lth;
#X connect 0 0 15 1;
#X connect 1 0 3 0;
#X connect 2 0 15 0;
#X connect 2 1 1 1;
#X connect 3 0 4 0;
#X connect 3 0 6 0;
#X connect 4 0 3 1;
#X connect 5 0 3 1;
#X connect 6 0 7 0;
#X connect 7 0 2 0;
#X connect 7 1 0 0;
#X connect 8 0 12 0;
#X connect 9 0 8 0;
#X connect 10 0 0 1;
#X connect 11 0 14 0;
#X connect 14 0 13 0;
#X connect 14 1 8 0;
#X connect 14 2 1 0;
#X connect 14 3 8 1;
#X connect 14 3 5 0;
#X connect 14 4 2 1;
#X connect 15 0 9 0;
#X restore 218 114 pd YL;
#X text 260 113 <= Auditory Levels;
#X obj 136 206 list store;
#X msg 218 164 append \$1;
#X obj 136 64 t b b l b;
#N canvas 254 23 664 794 PTA 0;
#X obj 86 148 until;
#X obj 233 38 inlet;
#X obj 86 38 inlet;
#N canvas 301 23 368 336 set-array 0;
#X obj 147 66 inlet;
#X obj 174 195 array define yl_\$0;
#X obj 174 122 list length;
#X obj 174 143 change;
#X msg 174 168 resize \$1;
#X obj 147 94 t l l;
#X obj 147 221 array set yl_\$0;
#X connect 0 0 5 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 4 0 1 0;
#X connect 5 0 6 0;
#X connect 5 1 2 0;
#X restore 233 98 pd set-array;
#N canvas 301 23 363 323 set-array 0;
#X obj 85 52 inlet;
#X obj 214 108 list length;
#X obj 214 129 change;
#X msg 214 177 resize \$1;
#X obj 214 204 array define hz_\$0;
#X obj 149 237 array set hz_\$0;
#X obj 85 80 trigger bang list list;
#X obj 85 286 outlet;
#X obj 235 151 v size_\$0;
#X connect 0 0 6 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 2 0 8 0;
#X connect 3 0 4 0;
#X connect 6 0 7 0;
#X connect 6 1 5 0;
#X connect 6 2 1 0;
#X restore 86 74 pd set-array;
#X obj 86 100 v size_\$0;
#X obj 139 146 v i_\$0;
#X obj 120 251 until;
#X obj 86 202 v size_\$0;
#X obj 243 309 sel 1;
#N canvas 374 23 390 156 hz2erb 0;
#X obj 75 67 expr 11.17 * log(($f1+0.312)/($f1+14.675)) + 43;
#X obj 75 40 inlet;
#X obj 75 94 outlet;
#X connect 0 0 2 0;
#X connect 1 0 0 0;
#X restore 408 385 pd hz2erb;
#X obj 408 357 expr hz_\$0[i_\$0] * 0.001;
#X obj 243 332 trigger bang bang, f 28;
#N canvas 374 23 390 156 hz2erb 0;
#X obj 75 67 expr 11.17 * log(($f1+0.312)/($f1+14.675)) + 43;
#X obj 75 40 inlet;
#X obj 75 94 outlet;
#X connect 0 0 2 0;
#X connect 1 0 0 0;
#X restore 243 385 pd hz2erb;
#X obj 243 357 expr hz_\$0[j_\$0] * 0.001, f 25;
#X obj 243 414 expr dif_\$0 = abs($f1 - $f2);
#X obj 243 445 < 3;
#X obj 243 466 sel 1;
#X obj 243 534 expr sum_\$0 = sum_\$0 + pow(10 \, $f1/20);
#X obj 73 403 expr 20 * log10(sum_\$0);
#X obj 73 425 max 0;
#X obj 86 123 t f b;
#X msg 168 228 0;
#X obj 168 250 v j_\$0;
#X msg 139 124 0;
#X obj 73 472 max 0;
#X obj 243 504 expr yl_\$0[j_\$0] - kM_\$0 * dif_\$0;
#X obj 73 450 expr yl_\$0[i_\$0] - $f1;
#X obj 73 716 outlet;
#X obj 193 203 v sum_\$0;
#X msg 193 179 0;
#X obj 120 273 expr j_\$0 = j_\$0 + 1 \; j_\$0 != i_\$0;
#X obj 103 353 expr i_\$0 = i_\$0 + 1;
#X obj 86 173 t b b;
#X obj 73 521 expr 1-exp(-$f1/15);
#X text 37 473 Eq.6;
#X text 39 425 Eq.5;
#X text 37 521 Eq.7;
#X obj 432 414 v dif_\$0;
#X obj 86 224 t b b f b;
#X obj 155 630 ftom;
#X obj 73 567 trigger float bang float, f 28;
#X obj 155 608 expr hz_\$0[i_\$0];
#X obj 155 651 expr rint($f1-12);
#X obj 155 673 expr PTA_\$0[$f1] = PTA_\$0[$f1] + $f2;
#X connect 0 0 33 0;
#X connect 1 0 3 0;
#X connect 2 0 4 0;
#X connect 4 0 5 0;
#X connect 5 0 21 0;
#X connect 7 0 31 0;
#X connect 8 0 39 0;
#X connect 9 0 12 0;
#X connect 10 0 15 1;
#X connect 11 0 10 0;
#X connect 12 0 14 0;
#X connect 12 1 11 0;
#X connect 13 0 15 0;
#X connect 14 0 13 0;
#X connect 15 0 16 0;
#X connect 16 0 17 0;
#X connect 17 0 26 0;
#X connect 19 0 20 0;
#X connect 20 0 27 0;
#X connect 21 0 0 0;
#X connect 21 1 24 0;
#X connect 22 0 23 0;
#X connect 24 0 6 0;
#X connect 25 0 34 0;
#X connect 26 0 18 0;
#X connect 27 0 25 0;
#X connect 30 0 29 0;
#X connect 31 1 9 0;
#X connect 33 0 8 0;
#X connect 33 1 30 0;
#X connect 34 0 41 0;
#X connect 39 0 32 0;
#X connect 39 1 19 0;
#X connect 39 2 7 0;
#X connect 39 3 22 0;
#X connect 40 0 43 0;
#X connect 41 0 28 0;
#X connect 41 1 42 0;
#X connect 41 2 44 1;
#X connect 42 0 40 0;
#X connect 43 0 44 0;
#X restore 218 139 pd PTA;
#X text 60 203 (Eq.7) Audibility Ap(P) =====>, f 12;
#N canvas 442 88 388 250 init 0;
#X obj 190 117 loadbang;
#X msg 190 143 12;
#X obj 190 168 v kM_\$0;
#X obj 163 75 array define CTA_\$0 120;
#X obj 247 186 v ncats_\$0;
#X msg 247 141 12;
#X obj 247 163 * 10;
#X obj 151 192 v kT_\$0;
#X msg 151 169 3;
#X obj 85 31 inlet;
#X msg 85 73 const 0;
#X obj 85 127 s CTA_\$0;
#X obj 164 48 array define PTA_\$0 120;
#X obj 96 101 s PTA_\$0;
#X connect 0 0 1 0;
#X connect 0 0 5 0;
#X connect 0 0 8 0;
#X connect 1 0 2 0;
#X connect 5 0 6 0;
#X connect 6 0 4 0;
#X connect 8 0 7 0;
#X connect 9 0 10 0;
#X connect 10 0 11 0;
#X connect 10 0 13 0;
#X restore 68 165 pd init;
#N canvas 403 38 619 564 CTA 0;
#X obj 134 124 until;
#X obj 134 159 f;
#X obj 167 159 + 1;
#X msg 177 123 0;
#X obj 115 70 v ncats_\$0;
#X msg 188 227 10;
#X obj 188 254 until;
#X obj 188 303 ftom;
#X obj 134 199 t f f;
#X obj 365 231 + 12;
#X obj 365 255 mtof;
#X obj 115 43 inlet;
#X msg 255 224 0;
#X obj 255 254 v n_\$0;
#X obj 305 254 v sum_\$0;
#X obj 188 200 trigger bang bang float;
#X obj 188 326 expr sum_\$0 = sum_\$0 + sqrt(PTA_\$0[rint($f1)-12]/n_\$0)
;
#X obj 134 354 expr CTA_\$0[$f1] = (sum_\$0*sum_\$0)/kT_\$0;
#X text 265 407 Ac(P);
#X text 228 407 Eq.10;
#X obj 115 435 * 0.2;
#X obj 115 406 array max CTA_\$0;
#X obj 115 98 t b f b;
#X obj 115 469 outlet;
#X obj 188 280 expr (n_\$0 = n_\$0 + 1) * $f2;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 1 0 8 0;
#X connect 2 0 1 1;
#X connect 3 0 1 1;
#X connect 4 0 22 0;
#X connect 5 0 6 0;
#X connect 6 0 24 0;
#X connect 7 0 16 0;
#X connect 8 0 17 0;
#X connect 8 1 15 0;
#X connect 9 0 10 0;
#X connect 10 0 24 1;
#X connect 11 0 4 0;
#X connect 12 0 13 0;
#X connect 12 0 14 0;
#X connect 15 0 5 0;
#X connect 15 1 12 0;
#X connect 15 2 9 0;
#X connect 20 0 23 0;
#X connect 21 0 20 0;
#X connect 22 0 21 0;
#X connect 22 1 0 0;
#X connect 22 2 3 0;
#X connect 24 0 7 0;
#X restore 220 206 pd CTA;
#X text 315 280 Tc: Most Audible Ac(P);
#X text 268 279 Eq. 13;
#X text 214 307 Complex Sonorousness;
#X obj 220 280 outlet;
#X obj 136 280 outlet;
#X text 46 298 Tp;
#X text 64 299 Pure Sonorousness;
#X text 90 279 Eq. 12;
#N canvas 344 123 342 295 Tp 0;
#X obj 92 140 pow 2;
#N canvas 241 24 347 283 drip 0;
#X obj 81 98 until;
#X obj 94 181 list store;
#X obj 115 68 t b b l;
#X obj 81 126 f;
#X obj 120 126 + 1;
#X msg 138 98 0, f 2;
#X msg 81 155 get \$1 1;
#X obj 115 36 inlet;
#X obj 94 211 outlet;
#X connect 0 0 3 0;
#X connect 1 0 8 0;
#X connect 1 1 0 1;
#X connect 2 0 0 0;
#X connect 2 1 5 0;
#X connect 2 2 1 1;
#X connect 3 0 4 0;
#X connect 3 0 6 0;
#X connect 4 0 3 1;
#X connect 5 0 3 1;
#X connect 6 0 1 0;
#X connect 7 0 2 0;
#X restore 92 115 pd drip;
#X obj 92 161 expr sum_\$0 = sum_\$0 + $f1;
#X obj 73 192 expr 0.5 * sqrt(sum_\$0);
#X obj 73 89 t b l b;
#X msg 152 110 0;
#X obj 152 132 v sum_\$0;
#X obj 73 55 inlet;
#X obj 73 221 outlet;
#X connect 0 0 2 0;
#X connect 1 0 0 0;
#X connect 3 0 8 0;
#X connect 4 0 3 0;
#X connect 4 1 1 0;
#X connect 4 2 5 0;
#X connect 5 0 6 0;
#X connect 7 0 4 0;
#X restore 136 244 pd Tp;
#X connect 0 0 2 1;
#X connect 1 0 6 0;
#X connect 2 0 7 0;
#X connect 2 1 7 1;
#X connect 4 0 19 0;
#X connect 5 0 4 0;
#X connect 6 0 4 0;
#X connect 6 1 10 0;
#X connect 6 2 2 0;
#X connect 6 3 4 1;
#X connect 6 3 9 0;
#X connect 7 0 5 0;
#X connect 10 0 14 0;
#X connect 19 0 15 0;
#X restore 362 191 pd tonalness;
#X text 446 191 <= vanilla implementation;
#X text 145 39 Get the Tonalness of a spectrum \, model by Parncutt
(89).;
#X msg 193 155 1 0.9 0.8;
#X msg 431 155 1 0.9 0.8;
#X msg 112 155 100 210 340;
#X msg 332 156 100 210 340;
#X connect 0 0 1 0;
#X connect 1 0 14 0;
#X connect 1 1 12 0;
#X connect 4 0 5 0;
#X connect 5 0 15 0;
#X connect 5 1 13 0;
#X connect 6 0 3 0;
#X connect 6 1 2 0;
#X connect 9 0 8 0;
#X connect 9 1 7 0;
#X connect 12 0 6 1;
#X connect 13 0 9 1;
#X connect 14 0 6 0;
#X connect 15 0 9 0;
